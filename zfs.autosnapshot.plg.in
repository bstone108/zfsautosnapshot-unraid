<?xml version='1.0' standalone='yes'?>
<PLUGIN name="zfs.autosnapshot" author="Brandon Stone" version="__VERSION__" pluginURL="__BASE_URL__/zfs.autosnapshot.plg" Launch="Settings/ZFSAutoSnapshot">
  <CHANGES>
### __VERSION__ (__BUILD_DATE__)
- Fixed package download block to use explicit `&lt;URL&gt;` and `&lt;MD5&gt;` nodes required by current Unraid plugin installer.
- Fixed install/remove script paths to use literal values (avoids unresolved XML entities in CDATA).
- Switched to canonical 2-page Unraid layout (`xmenu` entry + child settings page).
- Moved Settings tile placement to `OtherSettings` for broad UI compatibility.
- Added explicit plugin `Launch` target (`Settings/ZFSAutoSnapshot`).
- Web UI for dataset checkbox selection and retention settings.
- Plain-English scheduling (hourly/daily/weekly/custom) with cron sync.
- Time-based and space-based cleanup plus fresh snapshot creation.
  </CHANGES>

  <FILE Name="/boot/config/plugins/zfs.autosnapshot/zfs-autosnapshot-__VERSION__-noarch-1.txz" Min="6.11.0">
    <URL>__BASE_URL__/zfs-autosnapshot-__VERSION__-noarch-1.txz</URL>
    <MD5>__PKG_MD5__</MD5>
  </FILE>

  <FILE Run="/bin/bash">
    <![CDATA[
upgradepkg --install-new /boot/config/plugins/zfs.autosnapshot/zfs-autosnapshot-__VERSION__-noarch-1.txz;
    ]]>
  </FILE>

  <FILE Run="/bin/bash" Method="remove">
    <![CDATA[
if [ -x /usr/local/emhttp/plugins/zfs.autosnapshot/scripts/pre-remove.sh ]; then
  /usr/local/emhttp/plugins/zfs.autosnapshot/scripts/pre-remove.sh || true
fi

removepkg zfs-autosnapshot >/dev/null 2>&1 || true
rm -f /boot/config/plugins/zfs.autosnapshot/zfs-autosnapshot-*-noarch-1.txz
rm -f /boot/config/plugins/zfs.autosnapshot/zfs-autosnapshot-*-noarch-1.txz.md5
rmdir /boot/config/plugins/zfs.autosnapshot 2>/dev/null || true
    ]]>
  </FILE>
</PLUGIN>
