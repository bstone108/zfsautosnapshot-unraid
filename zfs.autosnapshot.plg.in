<?xml version='1.0' standalone='yes'?>
<!DOCTYPE PLUGIN [
<!ENTITY name "zfs.autosnapshot">
<!ENTITY author "Brandon Stone">
<!ENTITY version "__VERSION__">
<!ENTITY pluginURL "__BASE_URL__/zfs.autosnapshot.plg">
<!ENTITY package "zfs-autosnapshot-__VERSION__-noarch-1.txz">
<!ENTITY packageMD5 "__PKG_MD5__">
<!ENTITY packageURL "__BASE_URL__/&package;">
]>
<PLUGIN name="&name;" author="&author;" version="&version;" pluginURL="&pluginURL;">
  <CHANGES>
### __VERSION__ (__BUILD_DATE__)
- Added dedicated 128x128 plugin tile icon asset.
- Settings page registration fix with Utilities icon tile.
- Web UI for dataset checkbox selection and retention settings.
- Plain-English scheduling (hourly/daily/weekly/custom) with cron sync.
- Time-based and space-based cleanup plus fresh snapshot creation.
  </CHANGES>

  <FILE Name="/boot/config/plugins/&name;/&package;" Min="6.11.0">&packageURL;</FILE>
  <FILE Name="/boot/config/plugins/&name;/&package;.md5">&packageMD5;</FILE>

  <FILE Run="/bin/bash">
    <![CDATA[
upgradepkg --install-new /boot/config/plugins/&name;/&package;
    ]]>
  </FILE>

  <FILE Run="/bin/bash" Method="remove">
    <![CDATA[
if [ -x /usr/local/emhttp/plugins/&name;/scripts/pre-remove.sh ]; then
  /usr/local/emhttp/plugins/&name;/scripts/pre-remove.sh || true
fi

removepkg zfs-autosnapshot >/dev/null 2>&1 || true
rm -f /boot/config/plugins/&name;/zfs-autosnapshot-*-noarch-1.txz
rm -f /boot/config/plugins/&name;/zfs-autosnapshot-*-noarch-1.txz.md5
rmdir /boot/config/plugins/&name; 2>/dev/null || true
    ]]>
  </FILE>
</PLUGIN>
